<HTML>

<HEAD>
    <TITLE> Custom Widget </TITLE>
</HEAD>

<body onload="setWidgetList();">
    <script>
    // 보드 위젯 리스트
    var listBoard = [];

    // 유저 정보에 따라 불러와서 유저가 다운받은 위젯을 리모콘에 집어넣음 
    function setWidgetList() {
        /* 이미 배치된 위젯을 불러오는 부분 */
        obMouse.setWidget('트와이스', '<iframe width=100% height=100% src="https://www.youtube.com/embed/hs3lIhlTRJM" frameborder="0" allowfullscreen></iframe>');
        obMouse.setLocation(100, 150);
        setModeOn();
       
        /* 유저가 내려받은 위젯을 리모콘에 추가한다 */
        addWidget('초아', "<iframe width=100% height=100% src='https://www.youtube.com/embed/G9zL-A78oRg' frameborder='0' allowfullscreen></iframe>");
        addWidget('태연', "<iframe width=100% height=100% src='https://www.youtube.com/embed/Ri6wvGjuoOg' frameborder='0' allowfullscreen></iframe>");
    }

    // 리모콘 폼에 대한 드래그 이벤트
    var x = 0
    var y = 0
    drag = 0
    move = 0
    window.document.onmousemove = mouseMove
    window.document.onmousedown = mouseDown
    window.document.onmouseup = mouseUp
    window.document.ondragstart = mouseStop

    function mouseUp() {
        move = 0
    }

    function mouseDown() {
        if (drag) {
            clickleft = window.event.x - parseInt(dragObj.style.left);
            clicktop = window.event.y - parseInt(dragObj.style.top);
            dragObj.style.zIndex += 1;
            move = 1;
        }
    }

    function mouseMove() {
        if (move) {
            dragObj.style.left = window.event.x - clickleft;
            dragObj.style.top = window.event.y - clicktop;
        }
    }

    function mouseStop() {
        window.event.returnValue = false;
    }
    </script>
    </head>
    <div id="board" onclick="pos(event);" style="width:100%; height:100%;">
        <script type="text/javascript">
        // 보드부분 마우스 클릭 이벤트
        function pos(event) {
            // 마우스에 객체가 없을경우 return;
            if (!obMouse.getHave()) return;
            obMouse.setLocation(event.pageX, event.pageY);
        }
        </script>
    </div>
    <div id="Notice" style="width:200px; height:300px; position:absolute; left:950px; top:50px; z-index:99999; filter:revealTrans(transition=23,duration=0.5) blendTrans(duration=0.5);">
        <div id="moveDIV" style="width:200px; height:20px; background-color:black;" onmouseover="dragObj=Notice; drag=1;move=0" onmouseout="drag=0">
        </div>
        <table border="1" cellspacing="0" width="200" bordercolordark="white" bordercolorlight="#990000" bgcolor="white">
            <tr>
                <td width="173" bgcolor="white" align="center">
                    <form name="form">
                        <select name="widgetSel" onchange="javascript:getWidget()" style="width:140px;margin:10px;">
                            <option value='' selected>
                            </OPTION>
                            <script type="text/javascript">
                            /**
                             * select control에 정보 집어넣는 부분
                             */
                            function addWidget(name, tag) {
                                var op = document.createElement("option");

                                op.value = tag;
                                op.text = name;

                                document.form.widgetSel.options.add(op);
                            }

                            // select box 에서 위젯 선택시
                            function getWidget() {

                                var f = document.form.widgetSel;
                                var idx = f.selectedIndex; //인덱스
                                var widgetTag = f.options[idx].value; //인덱스 값
                                var name = f.options[idx].text; // 인텍스 이름

                                if (widgetTag != '') {
                                    obMouse.setWidget(name, widgetTag);
                                }
                            }
                            </script>
                        </select>
                    </form>
                </td>
            </tr>
            <tr>
                <td>
                    <p align="center" class="page">
                        <input type=button value="수정완료" onclick="setModeOn()" style="width:140px;margin:10px 0px 5px 0px;">
                        <script type="text/javascript">
                        function setModeOn() {
                            // listBorad에 저장된 태그와
                            // 좌표를 이용하여 div를 iframe으로 바꿈
                            // 
                            // 
                            // 키고 끌 경우 리모콘을 보이고 안 보이고 만들어야 함
                            // 
                            // 
                            for (var i in listBoard) {
                                // div에서 좌표를 받아옴
                                var div = listBoard[i];

                                // 집어 넣는부분 
                                div.innerHTML = div.getObjectTag();
                            }
                        }
                        </script>
                        <br>
                        <input type=button value="수정" onclick="setModeOff()" style="width:140px;margin:0px 0px 10px 0px;">
                        <script type="text/javascript">
                        function setModeOff() {
                            // listBorad에 저장된 태그와
                            // 좌표를 이용하여 div를 iframe으로 바꿈
                            for (var i in listBoard) {
                                // div에서 좌표를 받아옴
                                var div = listBoard[i];

                                // 넣은거 빼는부분
                                div.innerHTML = div.id;
                                div.innerText = div.id + "widget (더블클릭하면 삭제)";
                            }
                        }
                        </script>
                        <input type=button value="웹" onclick="" style="width:65px;margin:0px 3px 10px 0px;">
                        <script type="text/javascript">
                        // 저장 하는 부분 작성
                        </script>
                        <input type=button value="로컬" onclick="localSave()" style="width:65px;margin:0px 0px 10px 3px;">
                        <!-- 저장을 위한 임스 iframe -->
                        <script type="text/javascript">
                        function localSave() {
                            alert(document.documentElement.outerHTML);

                            var txt = document.getElementById("board").innerHTML;
                            var fileName = "C:\\text.txt";
                            var obFile = new ActiveXObject("Scripting.FileSystemObject");

                            obFile.CreateTextFile(filename, true);

                            var f = obFile.OpenTextFile(filename, 2, true);
                            alert(txt);
                            f.Write(txt);
                            f.Close();

                            /*
                            Some.document.open("outPut/html", "replace")
                            Some.document.write(document.documentElement.outerHTML)
                            Some.document.close()
                            Some.focus()
                            Some.document.execCommand('SaveAs');
                            */
                        }
                        </script>
                </td>
            </tr>
        </table>
    </div>
    <script type="text/javascript">
    /*************************************************************************************/

    // 마우스 클래스
    var obMouse = new mouse();
    /**
     * 마우스 클래스
     * 리모콘에서 위젯을 선택하면
     * 그 위젯값을 가지고 있다가 배치해줌
     */
    function mouse() {
        // 마우스가 현제 객체를 가지고 있는지의 여부
        var have = 0;
        var widgetTag;
        var name;

        //좌표
        var px, py;

        this.setWidget = function(name, tag) {
            have = 1;
            this.name = name;
            this.widgetTag = tag;
        }

        this.setLocation = function(x, y) {
            // 초기화
            var div = document.createElement("div");
            var objectTag = this.widgetTag;

            div.id = this.name;
            div.innerText = div.id + "widget (더블클릭하면 삭제)";
            div.style.width = "560px";
            div.style.height = "315px";
            div.style.backgroundColor = "red";
            div.style.position = "absolute";
            div.style.left = x + "px";
            div.style.top = y + "px";

            div.getObjectTag = function() {
                return objectTag;
            };
            // 위잿의 드래그 이벤트
            div.onmousedown = function(event) {
                // offsetLeft,offsetTop : 부모요소를 기준한 좌표지점.
                px = event.clientX - event.srcElement.offsetLeft;
                py = event.clientY - event.srcElement.offsetTop;
                flag = 1;
            };

            div.onmouseup = function(event) {
                flag = 0;
            };

            div.onmousemove = function(event) {
                if (flag == 0)
                    return;

                if (x > 0)
                    event.srcElement.style.left = event.clientX - px + "px";
                if (y > 0)
                    event.srcElement.style.top = event.clientY - py + "px";
            };

            // 삭제함 
            div.ondblclick = function(event) {
                document.getElementById('board').removeChild(this);
            };

            div.onclick = function(event){
                div.style.width = "780px";
                div.style.height = "515px";
            };

            document.getElementById('board').appendChild(div);

            // div를 배치했기 때문에 초기화
            have = 0;

            // 진짜 div 태그를 리스트에 저장
            listBoard.push(div);
        }

        this.getHave = function() {
            return have;
        }
    }
    </script>
</BODY>

</HTML>
